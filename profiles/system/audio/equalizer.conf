# Uses 10 band parametric EQ values from here:
# https://github.com/jaakkopasanen/AutoEq/tree/master/results/oratory1990/harman_over-ear_2018/Sennheiser%20GAME%20ONE

context.properties = {
  log.level = 2
}

context.spa-libs = {
  audio.convert.* = audioconvert/libspa-audioconvert
  support.* = support/libspa-support
}

context.modules = [
  { name = libpipewire-module-rtkit
    args = { }
    flags = [ ifexists nofail ]
  }
  { name = libpipewire-module-protocol-native }
  { name = libpipewire-module-client-node }
  { name = libpipewire-module-adapter }

  { name = libpipewire-module-filter-chain
    args = {
      node.description = "Sennheiser Game ONE Equalized Audio"
      media.name = "Equalized Headphones"
      filter.graph = {
        # Gain is calculated as pow(10, db/20)
        nodes = [
          { type = builtin name = mixerIL label = mixer control = { "Gain 1" = 0.457088 } }
          { type = builtin name = mixerIR label = mixer control = { "Gain 1" = 0.457088 } }

          { type = builtin name = eq_1L label = bq_peaking control = { "Freq" = 25.0 "Q" = 0.41 "Gain" = 2.113489 } }
          { type = builtin name = eq_1R label = bq_peaking control = { "Freq" = 25.0 "Q" = 0.41 "Gain" = 2.113489 } }
          { type = builtin name = eq_2L label = bq_peaking control = { "Freq" = 190.0 "Q" = 0.43 "Gain" = 0.645654 } }
          { type = builtin name = eq_2R label = bq_peaking control = { "Freq" = 190.0 "Q" = 0.43 "Gain" = 0.645654 } }
          { type = builtin name = eq_3L label = bq_peaking control = { "Freq" = 1761.0 "Q" = 3.35 "Gain" = 1.44544 } }
          { type = builtin name = eq_3R label = bq_peaking control = { "Freq" = 1761.0 "Q" = 3.35 "Gain" = 1.44544 } }
          { type = builtin name = eq_4L label = bq_peaking control = { "Freq" = 7832.0 "Q" = 2.77 "Gain" = 1.905461 } }
          { type = builtin name = eq_4R label = bq_peaking control = { "Freq" = 7832.0 "Q" = 2.77 "Gain" = 1.905461 } }
          { type = builtin name = eq_5L label = bq_peaking control = { "Freq" = 10428.0 "Q" = 2.87 "Gain" = 1.927525 } }
          { type = builtin name = eq_5R label = bq_peaking control = { "Freq" = 10428.0 "Q" = 2.87 "Gain" = 1.927525 } }
          { type = builtin name = eq_6L label = bq_peaking control = { "Freq" = 2734.0 "Q" = 3.4 "Gain" = 0.812831 } }
          { type = builtin name = eq_6R label = bq_peaking control = { "Freq" = 2734.0 "Q" = 3.4 "Gain" = 0.812831 } }
          { type = builtin name = eq_7L label = bq_peaking control = { "Freq" = 3260.0 "Q" = 2.55 "Gain" = 1.109175 } }
          { type = builtin name = eq_7R label = bq_peaking control = { "Freq" = 3260.0 "Q" = 2.55 "Gain" = 1.109175 } }
          { type = builtin name = eq_8L label = bq_peaking control = { "Freq" = 3930.0 "Q" = 3.3 "Gain" = 1.64059 } }
          { type = builtin name = eq_8R label = bq_peaking control = { "Freq" = 3930.0 "Q" = 3.3 "Gain" = 1.64059 } }
          { type = builtin name = eq_9L label = bq_peaking control = { "Freq" = 5556.0 "Q" = 2.9 "Gain" = 0.473151 } }
          { type = builtin name = eq_9R label = bq_peaking control = { "Freq" = 5556.0 "Q" = 2.9 "Gain" = 0.473151 } }
          { type = builtin name = eq_10L label = bq_peaking control = { "Freq" = 6395.0 "Q" = 5.28 "Gain" = 1.927525 } }
          { type = builtin name = eq_10R label = bq_peaking control = { "Freq" = 6395.0 "Q" = 5.28 "Gain" = 1.927525 } }
        ]
        inputs = [ "mixerIL:In 1" "mixerIR:In 1" ]
        outputs = [ "eq_10L:Out" "eq_10R:Out" ]
        links = [
          { output = "mixerIL:Out" input = "eq_1L:In" }
          { output = "mixerIR:Out" input = "eq_1R:In" }

          { output = "eq_1L:Out" input = "eq_2L:In" }
          { output = "eq_1R:Out" input = "eq_2R:In" }
          { output = "eq_2L:Out" input = "eq_3L:In" }
          { output = "eq_2R:Out" input = "eq_3R:In" }
          { output = "eq_3L:Out" input = "eq_4L:In" }
          { output = "eq_3R:Out" input = "eq_4R:In" }
          { output = "eq_4L:Out" input = "eq_5L:In" }
          { output = "eq_4R:Out" input = "eq_5R:In" }
          { output = "eq_5L:Out" input = "eq_6L:In" }
          { output = "eq_5R:Out" input = "eq_6R:In" }
          { output = "eq_6L:Out" input = "eq_7L:In" }
          { output = "eq_6R:Out" input = "eq_7R:In" }
          { output = "eq_7L:Out" input = "eq_8L:In" }
          { output = "eq_7R:Out" input = "eq_8R:In" }
          { output = "eq_8L:Out" input = "eq_9L:In" }
          { output = "eq_8R:Out" input = "eq_9R:In" }
          { output = "eq_9L:Out" input = "eq_10L:In" }
          { output = "eq_9R:Out" input = "eq_10R:In" }
        ]
      }
      audio.channels = 2
      audio.position = [ FL FR ]
      capture.props = {
        media.class = Audio/Sink
        node.name = "effect_input.eq10"
        # Connects audio sources to this sink
        node.autoconnect = true
      }
      playback.props = {
        node.name = "effect_output.eq10"
        # Links this source to the default sink
        # (becoming the new default playback sink)
        target.object = "alsa_input.pci-0000_00_1f.3.analog-stereo"
        node.passive = true
      }
    }
  }
]
